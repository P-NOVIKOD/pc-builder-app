<!DOCTYPE html>
<html>
<head>
    <title>PC Builder - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</title>
    <style>
        body { font-family: Arial; margin: 0; padding: 20px; }
        .container { display: grid; grid-template-columns: 300px 1fr; gap: 20px; }
        .components-sidebar { background: #f8f9fa; padding: 20px; border-radius: 10px; }
        .build-area { padding: 20px; }
        .component-category { margin-bottom: 20px; }
        .component-item { padding: 10px; border: 1px solid #ddd; margin: 5px 0; cursor: pointer; }
        .build-summary { background: #e9ecef; padding: 20px; border-radius: 10px; margin-top: 20px; }
    </style>
</head>
<body>
    <header>
        <h1>üõ†Ô∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ü–ö</h1>
        <nav>
            <a href="/builder">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</a> |
            <a href="/admin">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</a> |
            <button onclick="logout()">–í—ã–π—Ç–∏</button>
        </nav>
    </header>

    <div class="container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ -->
        <div class="components-sidebar">
            <h3>–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</h3>
            <div id="components-list">
                –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...
            </div>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —Å–±–æ—Ä–∫–∏ -->
        <div class="build-area">
            <h2>–¢–µ–∫—É—â–∞—è —Å–±–æ—Ä–∫–∞</h2>
            <div id="current-build">
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞</p>
            </div>
            
            <div class="build-summary">
                <h3>–°–≤–æ–¥–∫–∞</h3>
                <p>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: <span id="total-price">0</span> ‚ÇΩ</p>
                <p>–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ: <span id="total-tdp">0</span> W</p>
                <button onclick="saveBuild()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–±–æ—Ä–∫—É</button>
            </div>
        </div>
    </div>

    <script>
        let currentBuild = {};
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        fetch('/api/components')
            .then(r => r.json())
            .then(components => {
                const container = document.getElementById('components-list');
                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º
                const byType = components.reduce((acc, comp) => {
                    if (!acc[comp.type]) acc[comp.type] = [];
                    acc[comp.type].push(comp);
                    return acc;
                }, {});
                
                container.innerHTML = Object.entries(byType).map(([type, items]) => `
                    <div class="component-category">
                        <h4>${type.toUpperCase()}</h4>
                        ${items.map(item => `
                            <div class="component-item" onclick="addToBuild('${type}', ${JSON.stringify(item).replace(/'/g, "&#39;")})">
                                ${item.vendor} ${item.model} - ${item.price} ‚ÇΩ
                            </div>
                        `).join('')}
                    </div>
                `).join('');
            });

        function addToBuild(type, component) {
            currentBuild[type] = component;
            updateBuildDisplay();
        }

        function updateBuildDisplay() {
            const container = document.getElementById('current-build');
            const totalPrice = Object.values(currentBuild).reduce((sum, comp) => sum + comp.price, 0);
            const totalTdp = Object.values(currentBuild).reduce((sum, comp) => sum + (comp.tdp || 0), 0);
            
            container.innerHTML = Object.entries(currentBuild).map(([type, comp]) => `
                <div class="build-component">
                    <strong>${type}:</strong> ${comp.vendor} ${comp.model} - ${comp.price} ‚ÇΩ
                    <button onclick="removeFromBuild('${type}')">‚úï</button>
                </div>
            `).join('');
            
            document.getElementById('total-price').textContent = totalPrice;
            document.getElementById('total-tdp').textContent = totalTdp;
        }

        function removeFromBuild(type) {
            delete currentBuild[type];
            updateBuildDisplay();
        }

        function saveBuild() {
            const buildName = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏:');
            if (buildName) {
                fetch('/api/builds', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        name: buildName,
                        components: currentBuild
                    })
                }).then(() => alert('–°–±–æ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!'));
            }
        }

        function logout() {
            localStorage.removeItem('currentUserId');
            window.location.href = '/';
        }
    </script>
</body>
</html>